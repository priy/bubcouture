var HistoryManagerX=new Class({Implements:[Events,Options],options:{onStateChange:$empty,observeDelay:100,stateSeparator:";",iframeSrc:"javascript:void(0)"},dataOptions:{skipDefaultMatch:true,defaults:[],regexpParams:""},initialize:function(a){this.setOptions(a||{});if(this.modules){return this}this.modules=$H({});this.count=history.length;this.states=[];this.states[this.count]=this.getHash();return this},start:function(){this.observe.periodical(this.options.observeDelay,this);this.started=true;this.observe();this.update();this.fireEvent("onStart",[this.state]);return this},register:function(b,g,c,f,e,a){if(!this.modules){this.initialize()}var d=$merge(this.dataOptions,a||{},{defaults:g,onMatch:c,onGenerate:f,regexp:e});d.regexp=d.regexp||b+"-([\\w_-]*)";if(typeof d.regexp=="string"){d.regexp=new RegExp(d.regexp,d.regexpParams)}d.onGenerate=d.onGenerate||function(h){return b+"-"+h[0]};d.values=d.defaults.slice();this.modules.set(b,d);this.fireEvent("onUnregister",[b,d]);return{setValues:function(h){return this.setValues(b,h)}.bind(this),setValue:function(h,i){return this.setValue(b,h,i)}.bind(this),generate:function(h){return this.generate(b,h)}.bind(this),unregister:function(){return this.unregister(b)}.bind(this)}},unregister:function(a){this.fireEvent("onRegister",[a]);this.modules.remove(a)},setValues:function(b,a){var c=this.modules.get(b);if(!c||c.values.isSimilar(a)){return this}c.values=a;this.update();return this},setValue:function(b,a,d){var c=this.modules.get(b);if(!c||c.values[a]==d){return this}c.values[a]=d;this.update();return this},generate:function(b,a){var d=this.modules.get(b);var e=d.values.slice();d.values=a;var c=this.generateState();d.values=e;return"#"+c},observe:function(){if(!this){return}if(this.timeout){return}var a=this.getState();if(this.state==a){return}if((window.ie||window.webkit419)&&(this.state!==null)){this.setState(a,true)}else{this.state=a}this.modules.each(function(d,b){var c=a.match(d.regexp);if(c){c.splice(0,1);c.complement(d.defaults);if(!c.isSimilar(d.defaults)){d.values=c}}else{d.values=d.defaults.slice()}d.onMatch(d.values,d.defaults)});this.fireEvent("onStateChange",[a]).fireEvent("onObserverChange",[a])},generateState:function(){var a=[];this.modules.each(function(c,b){if(c.skipDefaultMatch&&c.values.isSimilar(c.defaults)){return}a.push(c.onGenerate(c.values))});return a.join(this.options.stateSeparator)},update:function(){if(!this.started){return this}var a=this.generateState();if((!this.state&&!a)||(this.state==a)){return this}this.setState(a);this.fireEvent("onStateChange",[a]).fireEvent("onUpdate",[a]);return this},observeTimeout:function(){if(this.timeout){this.timeout=$clear(this.timeout)}else{this.timeout=this.observeTimeout.delay(200,this)}},getHash:function(){var a=top.location.href;var b=a.indexOf("#")+1;return(b)?a.substr(b):""},getState:function(){var b=this.getHash();if(this.iframe){try{var f=this.iframe.contentWindow;if(!f){return}var d=f.document;if(d&&d.body.id=="state"){var a=d.body.innerText;if(this.state==b){return a}this.istateOld=true}else{return this.istate}}catch(c){}}if(window.webkit419&&history.length!=this.count){this.count=history.length;return $pick(this.states[this.count-1],b)}return b},setState:function(b,a){b=$pick(b,"");if(window.webkit419){if(!this.form){this.form=new Element("form",{method:"get"}).injectInside(document.body)}this.count=history.length;this.states[this.count]=b;this.observeTimeout();this.form.setProperty("action","#"+b).submit()}else{top.location.hash=b||"#"}if(window.ie&&(!a||this.istateOld)){if(!this.iframe){this.iframe=new Element("iframe",{name:"historyfrm",src:this.options.iframeSrc,styles:"display: none;"}).injectInside(document.body);this.istate=this.state}try{var d=this.iframe.contentWindow.document;d.open();d.write('<html><body id="state">'+b+"</body></html>");d.close();this.istateOld=false}catch(c){}}this.state=b},implement:$extend});Array.implement({isSimilar:function(a){return(this.toString()==a.toString())},complement:function(c){for(var b=0,a=this.length;b<a;b++){this[b]=$pick(this[b],c[b]||null)}return this}});var historyManager;window.addEvent("domready",function(){historyManager=new HistoryManagerX()});
void function(){var c=new Hash();try{c.empty.periodical(60*1000,c)}catch(d){}var b=new Class({Extends:Ajax,initialize:function(f,e){c.set(f,"init");this.addEvent("onCancel",function(){c.set(f,"cancel")});this.parent(f,e)},send:function(h,g){c.set(this.url,"request");if(!this.check(arguments.callee,g)){return this}this.running=true;var i=$type(g);if(i=="string"||i=="element"){g={data:g}}var f=this.options;g=$extend({data:f.data,url:h,method:f.method},g);var k=g.data,h=g.url,m=g.method;switch($type(k)){case"element":k=$(k).toQueryString();break;case"object":case"hash":k=Hash.toQueryString(k)}if(this.options.urlEncoded&&"post"==m.toLowerCase()){var j=(this.options.encoding)?"; charset="+this.options.encoding:"";this.headers.set("Content-type","application/x-www-form-urlencoded"+j)}if(k&&"get"==m.toLowerCase()){h=h+(h.contains("?")?"&":"?")+k;k=null}h+="&_ajax=true";if(W){h+="&_ss="+W.sideStore}this.xhr.open(m.toUpperCase(),h,this.options.async);this.xhr.onreadystatechange=this.onStateChange.bind(this);this.headers.each(function(n,e){if(!$try(function(){this.xhr.setRequestHeader(e,n);return true}.bind(this))){this.fireEvent("exception",[e,n])}},this);this.loadMask("onrequest",$(this.options.update));if(window.ie&&this.options.update&&$(this.options.update)){try{$ES("iframe",this.options.update).each(function(n){n.remove()})}catch(l){}}this.fireEvent("request");this.xhr.send(k);if(!this.options.async){this.onStateChange()}return this},onFailure:function(){if($chk($("loadMask"))){this.loadMask("onfailure")}switch(this.transport.status){case 404:MessageBox.error("页面未找到.");break;case 401:new Dialog("401.html",{ajaksable:false,modal:true,width:300,height:150,resizeable:false});break;case 403:MessageBox.error("您无此操作的权限.");break}c.set(this.url,"failure");this.fireEvent("onFailure",this.transport)},onException:function(f,e){if($chk($("loadMask"))){this.loadMask("onException")}MessageBox.error("出现错误:"+f+":"+e)},success:function(i,g){var f=this.options;var e=this.response;var h=$(f.update);e.html=i.stripScripts(function(j){e.javascript=j});e.html=this.processHTML(e.html);if(!h){MessageBox.show(e.html);this.onSuccess(e.html);this.loadMask("complete");return}if(f.elMap){$each(f.elMap,function(k,j){if(j==".sideContent"){return}$(k).empty().setStyle("fontSize",0)});e.html=e.html.replace(/<\!-{5}(.*?)-{5}([\s\S]*?)-{5}(.*?)-{5}>/g,function(){if(f.elMap[arguments[1]]){if(arguments[1]==".sideContent"&&arguments[2]){f.elMap[arguments[1]].adopt(new Element("div").setHTML(arguments[2]).getFirst().setStyle("display","none"))}else{f.elMap[arguments[1]].set("html",arguments[2]).setStyle("fontSize","")}}return""});updateSize()}h.empty().setHTML(e.html);if(f.evalScripts){$exec(e.javascript)}makeAjaksLink(h);this.onSuccess(e.html,null,f,null,e.javascript);this.loadMask("oncomplete");document.title=$("shop_title_block").getText()+" - Powered By ShopEx"},loadMask:function(e,g){g=$(g);var f=g||window;switch(e){case"onrequest":return $("loadMask").amongTo(window).show();default:$("loadMask").hide();c.set(this.url,"success")}}});ShopEx_AdminXHR=new Class({options:{evalScripts:true,autoCancel:true,method:"get",elMap:false,data:null,link:"cancel"},initialize:function(){this.historyMangerInit.call(this);$$("#mainMenus a[name]").addEvent("click",function(f){f.stop();document.body.fireEvent("click",{target:this,stop:$empty})})},historyMangerInit:function(){try{this.history=historyManager.register("page",["ctl=dashboard&act=getInfo"],function(e,i){var h=this.options;if($("main")){var g="index.php?"+(e.input?e.input:i[0]);return this.page(g)}}.bind(this),function(e){return e[0]},".*");historyManager.start()}catch(f){MessageBox.error(f.message)}},page:function(){var i=Array.flatten(arguments).link({url:String.type,options:Object.type,sponsor:Element.type});if(["request","init"].indexOf(c.get(f))>-1){return $("loadMask").amongTo(window).show()}var g=$merge(this.options,i.options);var f=i.url;var h=i.sponsor;if(g.autoCancel&&this.curAjax){this.curAjax.cancel()}if($type(g.data)=="element"){if(!$(g.data).bindValidator("x-input")){return $("loadMask").hide()}}g.update=g.update||$($chk(h)?$(h).getContainer():false)||"main";if(g.update=="main"||($type(g.update)=="element"&&g.update.id=="main")){var e=f.match("index\\.php\\?(.*)");if(e){this.history.setValue(0,e[1])}if(!g.elMap){g.elMap={".mainHead":$("headBar"),".mainFoot":$("footBar")}}}$extend(g.elMap,{".sideContent":$("sidecontent")});this.curAjax=new b(f,g);this.curAjax.request()}});var a=function(g){var h=location.hash.slice(1);if(!$("sidecontent").retrieve("info")){return}var f=$("sidecontent").retrieve("info").cur;var j=$("sidecontent").retrieve("curAction");var e=$("mainMenus").retrieve("curAction");if(j){j.removeClass("cur")}if(e){e.removeClass("current")}var k=$("submenu_"+f).getElement("a[href$="+h+"]");if(k){$("sidecontent").store("curAction",k.addClass("cur"))}var i=$("mainMenus").getElement("a[name="+g+"]");if(i){$("mainMenus").store("curAction",i.addClass("current"))}};SideRender=function(g){if(!g){return}var f=$("sidecontent");var h=f.retrieve("info",{cur:g,store:[]});var i=h.store;var e=h.cur;$("submenu_"+e).hide();$("submenu_"+g).show();h.cur=g;a(g);if(i.indexOf(g)>-1){return}i.include(g);if(W){W.sideStore=i.join(",")}showSide()};void function(){var f=function(g){if(g.getTag()!="a"){g=g.getParent("a")}if(!g){return false}if((!$chk($(g).target)||g.target.test("{","i"))&&!g.href.match(/^javascript.+/i)&&!g.onclick){return g}if(g.get("target")=="_blank"&&g.href.contains(SHOPADMINDIR)){return g}return false};var e=function(g){if(g.getTag()!="form"){return false}return $chk($(g).getProperty("action"))&&(!$chk(g.target)||g.target.test("{","i"))&&!g.onsubmit};$(document.body).addEvents({click:function(j){var i=f($(j.target));if(!i){return}j.stop();if(i.get("target")=="_blank"){return _open(i.href)}var k;try{k=Json.evaluate(i.target)}catch(j){if($chk(i.href)){return W.page(i.href,i)}return false}if(dlg=i.get("dialog")){var h={title:$pick(i.title,i.get("text")),width:window.getSize().x*0.7,height:window.getSize().y*0.7};dlg=JSON.decode(dlg);dlg=$type(dlg)=="object"?dlg:{};h=$extend(h,dlg);return new Dialog(i.href,h)}if("fm" in k&&$chk(k.fm)){var l=false;k.update=(k.update||"main");if(k.update=="main"||(k.update.id&&k.update.id=="main")){[$("footBar"),$("headBar")].each(Element.empty);updateSize()}var g=new Element("iframe",{name:k.fm,styles:{width:"100%",height:"98%",border:"none","overflow-y":"scroll"}}).inject($(k.update).empty());g.setProperty("src",i.href)}else{if(j.shift){return open(i.href.replace("?","#"))}W.page(i.href,k,i)}},submit:function(k){var h=$(k.target);if(e(h)){k.stop();new Element("input",{type:"hidden",value:1,name:"__"}).inject(h);if(!h.bindValidator("x-input")){return $("loadMask").hide()}$ES("textarea[ishtml=true]",h).getValue();var j=h.getProperty("action");var i=i||{};if(h.target.test("{","i")){try{i=Json.evaluate(h.target)}catch(k){}}if(f_target_obj=h.retrieve("target")){$extend(i,f_target_obj)}if(k.requestOptions){$extend(i,k.requestOptions)}var g=$ES('input[type="file"]',h);if(g.length>0&&g.some(function(l){return l.value})){MODALPANEL.show();$("loadMask").amongTo(window).show();if(!$("upload_iframe")){new Element("iframe",{id:"upload_iframe",name:"upload_iframe",styles:{display:"none"}}).inject(document.body)}if(h.target){h.store("reset_target",h.target)}h.setProperty("target","upload_iframe");h.set({enctype:"multipart/form-data",encoding:"multipart/form-data"});h.setProperty("action",h.getProperty("action")+"&_upload=true");window.upload_rs_el=i&&i.ure?i.ure:$(k.target).getContainer();h.submit();if(h.retrive("reset_target")){h.target=h.retrieve("reset_target")}else{h.target=""}return h.removeProperties("enctype","encoding")}if(i){if("fm" in i){h.setProperty("target",ftarget.fm);return h.submit()}return W.page(j,$extend(i,{method:h.getProperty("method"),data:h.toQueryString()}),h)}W.page(j,{method:h.getProperty("method"),data:h.toQueryString()},h)}}})}();makeAjaksLink=function(e){$(e).getElements("form").addEvent("submit",function(g){var f=g?(g.stop?g.stop:$empty):$empty;document.body.fireEvent("submit",$extend((g||{}),{target:this,stop:f}))})};Splash={go:function(g,f,e){$$($("loadMaks"),MODALPANEL).hide();(function(){var j=$$($("successSplash"),$("noticeSplash"),$("failedSplash"));var i;var h=j.some(function(k){if($chk(k)){i=k;return true}});if(i){W.page(g,JSON.decode(e),i)}}).delay(f.toInt())}}}();
void function(){finderGroup={};finderDestory=function(){for(var f in finderGroup){delete finderGroup[f]}};Element.Events.ListDrag={base:"mousedown",condition:function(f){return(f.control==true)}};var e=new Class({Extends:Drag,attach:function(){this.handles.addEvent("ListDrag",this.bound.start);return this},detach:function(){this.handles.removeEvent("ListDrag",this.bound.start);return this}});var b=new Class({Extends:Drag,start:function(f){if(this.element.getParent(".finder-header").scrollLeft>0){return}this.parent(f)}});var a=function(f,g,i,h){h=h||{x:0,y:0};var p=(i||window).getSize(),m=(i||window).getScroll();var o={x:f.offsetWidth,y:f.offsetHeight};var k={x:"left",y:"top"};for(var j in k){var l=g.page[j]+h[j];if((l+o[j]-m[j])>p[j]){l=g.page[j]-h[j]-o[j]}f.setStyle(k[j],l)}};var d=function(g,f){var h=$("msgStorage").retrieve("events",{finder_colset:{}});(h.finder_colset[g]=h.finder_colset[g]||{})[f[0]]=f[1]};Finder=new Class({Implements:[Events],options:{},initialize:function(g,f){$extend(this.options,f);this.id=g;this.initStaticView();this.initView();this.attachStaticEvents();this.attachEvents()},initStaticView:function(){$each(["action","form","search","tip","detail","header","footer"],function(f){this[f]=$("finder-"+f+"-"+this.id)},this)},initView:function(){this.list=$("finder-list-"+this.id).store("visibility",true);this.listContainer=this.list.getContainer()},isVisibile:function(){if(!this.list.retrieve){return false}return $chk(this.list.retrieve("visibility"))},attachStaticEvents:function(){var f=this;if(f.search){f.search.addEvent("submit",function(i){i.stop();var h=this;var g=h.getElement(".finder-search-input");f.filter.reset().push({value:g.value,name:h.get("current_key"),label:h.getElement("label").innerHTML+"为:<b>"+g.value+"&nbsp;</b>"});g.value=""});new DropMenu($E(".finder-search-select",f.action),{offset:{y:12,x:-5},relative:f.action})}if(f.tip){f.tip.addEvents({show:function(i,g){$$(this.childNodes).hide();var h=this.getElement("."+i);h.innerHTML=h.innerHTML.replace(/<em>([\s\S]*?)<\/em>/ig,function(){return"<em>"+g+"</em>"});h.setStyle("display","block");if(this.retrieve("show")){return}this.store("show",true);this.show();window.fireEvent("resize")},hide:function(){if(!this.retrieve("show")){return}this.store("show",false);$$(this.childNodes).hide();this.hide();window.fireEvent("resize")}})}if(f.action){f.action.getElements("*[submit]").addEvent("click",function(m){var o=this.get("target");var k=this.get("submit");var l=f.form.retrieve("rowselected");var h=new Element("div");for(n in l){if(n){$A(l[n]).each(function(q){h.adopt(new Element("input",{type:"hidden",name:n,value:q}))})}}var g=o,j={};if(o){if(o.contains("::")){g=o.split("::")[0];j=JSON.decode(o.split("::")[1]);if($type(j)!="object"){j={}}}}else{g="refresh"}if(!h.getFirst()){return MessageBox.error("请选择要操作的数据项.")}var i=this.getProperty("confirm");if(i){if(!window.confirm(i)){return}}if(!$(m.target).get("only_id")){h.adopt(f.form.toQueryString().toFormElements())}switch(g){case"refresh":W.page(k,$extend({data:h,method:"post",update:"messagebox",onComplete:f.refresh.bind(f)},j));break;case"dialog":var p=g.contains("::")?JSON.decode(g.split("::")[1]):{};window.finderDialog=new Dialog(k,$extend({title:this.get("dialogtitle")||this.get("text"),ajaxoptions:{data:h,method:"post"},onClose:f.refresh.bind(f)},j));break;case"_blank":new Element("form",{action:k,name:g,target:"_blank",method:"post"}).adopt(h).inject("elTempBox").submit();break;default:new Element("form",{action:k,name:g,method:"post"}).adopt(h).inject("elTempBox").submit();break}})}if(f.header){f.header.addEvent("click",function(h){var g=$(h.target);if(!g.hasClass("orderable")){g=g.getParent(".orderable")}if(!g){return}var i=[("desc"==g.get("order"))?"asc":"desc",g.get("key")].link({"_finder[orderType]":String.type,"_finder[orderBy]":String.type});f.fillForm(i).refresh();h.stopPropagation();return})}if(f.form){if(f.options.filterInit){new c(f.form.getElement(".finder-filter")).attach(f.options.filterInit);updateSize()}f.filter=new c(f.form.getElement(".finder-filter"),{onChange:function(){f.unselectAll();f.refresh()}})}if(f.detail){f.detail.retrieve("content",f.detail.getElement(".finder-detail-content"));f.detail.addEvents({slideIn:function(){var g=Array.flatten(arguments);if(this.retrieve("slideIn")){this.store("slideIn",g);return this.fireEvent("load",g)}this.store("slideIn",g);this.fireEvent("load",g);this.setStyle("height",f.listContainer.getSize().y*0.5);this.setStyle("width",f.listContainer.getSize().x);updateSize()},slideOut:function(){if(!this.retrieve("slideIn")){return}this.store("slideIn",false);this.retrieve("content").empty();this.setStyle("height",0);var g=this.retrieve("currow");if(g.removeClass){g.removeClass("view-detail")}this.store("item-id",null);updateSize()},load:function(j,i,l,k){if(!k){if(!$chk(l)||l.hasClass("view-detail")){return}if($type(this.retrieve("currow"))=="element"){$(this.retrieve("currow")).removeClass("view-detail")}this.store("currow",l.addClass("view-detail"));this.store("item-id",l.get("item-id"))}this.addClass("loading-content");var h=this;var g={update:h.retrieve("content"),onComplete:function(){h.fireEvent("complete",l)}};$extend(g,i);W.page(j+"&_finder_name="+f.id,g)},complete:function(g){if(g&&(g.getPosition().y>this.getPosition().y)){f.listContainer.retrieve("fxscroll",new Fx.Scroll(f.listContainer,{link:"cancel"})).toElement(g)}this.removeClass("loading-content")}})}},selectAll:function(){var f=this.header.getElement(".sellist");f.set("checked",true).fireEvent("change").set("checked",false);(this.form.retrieve("rowselected")[f.name]||[]).empty().push("_ALL_");this.tip.fireEvent("show","selectedall")},unselectAll:function(){var f=this.header.getElement(".sellist");f.set("checked",false).fireEvent("change");(this.form.retrieve("rowselected")[f.name]||[]).empty();this.tip.fireEvent("hide")},attachEvents:function(){var j=this;if(j.header){j.header.getElements("col").each(function(m,l){var l=l.toInt();var p=l+1;var o=j.header.getElement("td:nth-child("+p+")").getElement(".finder-col-resizer");if(!o){return}new b(m,{modifiers:{x:"width"},limit:{x:[15,1000]},handle:o,unit:0,onBeforeStart:function(q){q.store("lc",j.list.getElements("col")[l])},onDrag:function(r){if(!j.header.hasClass("col-resizing")){j.header.addClass("col-resizing")}var q=r.getStyle("width").toInt();$(r.retrieve("lc")).setStyle("width",q);$(r).addClass("resizing");if(window.webkit){j.header.getElement("td:nth-child("+p+")").setStyle("width",q);j.list.getElement("td:nth-child("+p+")").setStyle("width",q)}},onComplete:function(r){j.header.removeClass("col-resizing");$(r).removeClass("resizing");var q=j.list.getElement("td:nth-child("+p+")").get("key");d(j.options.controller,[q,r.getStyle("width").toInt()])}})})}var h=j.list.retrieve("eventInfo",{});var k=j.form.retrieve("rowselected",{});j.list.addEvents({selectrow:function(l){l.getParent(".row").addClass("selected")},unselectrow:function(l){l.getParent(".row").removeClass("selected")}});var g=j.list.getElements(".sel");j.rowCount=g.length;if(j.header&&j.header.getElement(".sellist")){j.header.getElement(".sellist").addEvent("change",function(){g.set("checked",this.checked);g.fireEvent("change")})}g.each(function(l){if(window.ie){l.addEvent("click",function(){this.fireEvent("change")});l.addEvent("focus",function(){this.blur()})}l.addEvent("change",function(){k[this.name]=k[this.name]||[];k[this.name][this.checked?"include":"erase"](this.value);if(!this.checked&&k[this.name].contains("_ALL_")){k[this.name].erase("_ALL_");return j.unselectAll()}var m=k[this.name].length;if(m>1){j.tip.fireEvent("show",["selected",m]);if(m==j.tip.get("count").toInt()||k[l.name].contains("_ALL_")){j.tip.fireEvent("show",["selectedall",m])}}else{j.tip.fireEvent("hide")}j.list.fireEvent(this.checked?"selectrow":"unselectrow",this)});if(k[l.name]&&k[l.name].push&&k[l.name].contains(l.value)){l.set("checked",true).fireEvent("change")}else{if(k[l.name]&&k[l.name].contains("_ALL_")){l.set("checked",true).fireEvent("change")}}if(row=l.getParent(".row")){if(row.get("item-id")==j.detail.retrieve("item-id")){row.addClass("view-detail");j.detail.store("currow",row);j.listContainer.retrieve("fxscroll",new Fx.Scroll(j.listContainer,{link:"cancel"})).toElement(row)}}});var i=j.list.getLast();if(i){i.addEvents({show:function(l){if(!l){return}var o=i.getSize().size;i.setStyles({visibility:"visible",opacity:0});i.retrieve("fx",new Fx.Styles(i,{link:"cancel",duration:400,transition:Fx.Transitions.Quint.easeOut})).start({opacity:1});var m=i.getElement(".cell-edit-action");m.addEvent("submet",function(){this.addClass("cell-edit-action-remote");i.store("requesting",true);var p=new Request({onSuccess:function(q){if(q.substring(0,3)=="ok:"){(l.getElement(".cell")||l).innerHTML=q.substring(3)}else{MessageBox.error(q)}i.fireEvent("hide",l);i.store("requesting",false)}});p.post(this.get("action"),this);this.store("request",p)});m.getElements("button").addEvent("click",function(p){if(this.hasClass("x-select-btn")){return}if(this.get("type")=="submit"){return m.fireEvent("submet",l)}i.fireEvent("hide",l)})},hide:function(l){this.setStyle("visibility","hidden");var m=this.getElement(".cell-edit-action")?this.getElement(".cell-edit-action").retrieve("request"):null;if(m&&"cancel" in m){m.cancel()}if(!l){return}["edit-ready","edit-begin","edit-ing"].each(l.removeClass,l);this.empty()}})}j.list.addEvent("click",function(m){var l=$(m.target);if(!l){return}if(l.match("img")){l=$(l.parentNode)}if(l.match("a")&&l.get("target")=="_blank"){var o=l.getParent(".row").getElement("input[class=sel]");o.set("checked",true);j.list.fireEvent("selectrow",o);o.fireEvent("change");return}if(_detail=l.get("detail")){m.stopPropagation();if(l.hasClass("btn-detail-open")&&l.getParent(".view-detail")){return j.hideDetail(_detail,{},l.getParent(".row"))}else{return j.showDetail(_detail,{},l.getParent(".row"))}}if(l.hasClass("cell")||l.hasClass("cell-inside")){l=l.getParent("td")}if(l.match("td")){if(j.detail.retrieve("slideIn")){if((detailbtn=l.getParent(".row").getElement("*[detail]"))&&!l.getParent(".row").hasClass("view-detail")){return j.showDetail(detailbtn.get("detail"),{},l.getParent(".row"))}}if(l.hasClass("editable")){if(l.hasClass("edit-ing")||l.hasClass("edit-begin")){return}if(l.hasClass("edit-ready")){l.addClass("edit-begin");j.editCell(l,m,function(p){l.addClass("edit-ing")});return}if(h.curcell){if(_editPanel=h.curcell.retrieve("editPanel")){if(_editPanel.retrieve("requesting")){return}_editPanel.fireEvent("hide")}h.curcell.removeClass("edit-ready").removeClass("edit-begin").removeClass("edit-ing")}l.addClass("edit-ready");h.curcell=l}}});attachEsayCheck(j.list,"td:nth-child(first)");var f=j.list.getContainer();if(j.header.getStyle("overflow")!="visible"){new e(j.header,{handle:j.list,style:false,modifiers:{x:"scrollLeft"},invert:true,preventDefault:true,onDrag:function(){f.scrollTo(j.header.getScrollLeft())},onStart:function(l){l.setStyle("cursor","move");j.list.addEvent("contextmenu",function(m){m.stop()})},onComplete:function(l){l.setStyle("cursor","default");(function(){j.list.removeEvents("contextmenu")}).delay(200)}})}},editCell:function(f,i,g){if(!f){return}var k=this;f.addClass("edit-begin");var j=k.list.getLast().setStyle("visibility","hidden");var h="index.php?ctl="+this.options.controller+"&act=cell_editor";new Request({onSuccess:function(l){j.set("html",l);a(j,i);j.fireEvent("show",f);f.store("editPanel",j);(g||$empty)(j)}}).post(h,{id:f.getParent(".row").get("item-id"),key:f.get("key").trim()})},fillForm:function(g){if(!g||"object"!=$type(g)){return}g=$H(g);var f=this;g.each(function(i,h){var j=(f.form.getElement("input[name^="+h.slice(0,-1)+"]")||new Element("input",{type:"hidden",name:h}).inject(f.form));j.set("value",i)});return f},eraseFormElement:function(){var f=Array.flatten(arguments);var g=this;$each(f,function(h){g.form.getElement("input[name="+h+"]").remove()});return g},showDetail:function(g,f,h){this.detail.fireEvent("slideIn",Array.flatten(arguments))},hideDetail:function(g,f,h){this.detail.fireEvent("slideOut",Array.flatten(arguments))},getQueryStringByForm:function(){return this.form.toQueryString()},page:function(f){this.form.store("page",f||1);this.request({method:this.form.method||"post"})},refresh:function(){this.request({method:this.form.method||"post",onComplete:function(){if(sinargs=this.detail.retrieve("slideIn")){sinargs.push("refresh");sinargs[2]=false;this.detail.fireEvent("load",sinargs)}}})},request:function(){var k=Array.flatten(arguments);var j=k.link({options:Object.type,action:String.type});j.action=j.action||this.form.action+"&page="+(this.form.retrieve("page")||1);j.options=j.options||{};var h=j.options.onComplete;if($type(h)!="function"){h=$empty}j.options=$extend(j.options,{elMap:{".mainHead":this.header,".mainFoot":this.footer},onComplete:function(){this.initView();this.attachEvents();h.apply(this,Array.flatten(arguments))}.bind(this)});var i=this.getQueryStringByForm();var g=j.options.data;switch($type(g)){case"string":j.options.data=[i,g].join("&");break;case"object":case"hash":j.options.data=[i,Hash.toQueryString(g)].join("&");break;case"element":j.options.data=[i,$(g).toQueryString()].join("&");break;default:j.options.data=i}var f=$("msgStorage").retrieve("events");if($H(f.finder_colset).getValues().length){new Request().post("index.php?ctl=default&act=status",{events:$("msgStorage").retrieve("events")}).chain(function(){f.finder_colset={};W.page(j.action,j.options)}.bind(this));return}W.page(j.action,j.options)}});var c=new Class({Implements:[Events,Options],options:{onPush:$empty,onRemove:$empty,onChange:$empty},initialize:function(g,f){var h=this;this.fp=$(g);this.fpInfo=this.fp.getElement(".finder-filter-info");this.fp.removeEvents("click").addEvent("click",function(j){var i=$(j.target);if(i&&i.hasClass("remove")){h.remove(i.getParent(".finder-filter-item"));return j.stopPropagation()}});this.setOptions(f)},push:function(g,h){if(this.fpInfo.getElement("input[name="+g.name+"]")){return this}var f=this.fp.getElement(".ffitpl").clone();if("array"==typeof(g.value)){g.name+="[]";g.each(function(i){new Element("input",{type:"hidden"}).set({name:g.name,value:g.value}).inject(f)})}else{if(g.name=="order_id"){g.name="order_id[]"}new Element("input",{type:"hidden"}).set({name:g.name,value:g.value}).inject(f)}if(mg=g.merge){$splat(mg).each(function(j){var i;if($type(j)=="object"){i=new Element("input",{type:"hidden"}).set({name:j.name,value:j.value})}if($type(j)=="string"){i=j.toFormElements()}f.adopt(i)});delete (g.merge)}f.getElement("span").set("html",g.label);f.className="finder-filter-item";this.fpInfo.adopt(f);if(h){return this}this.change();return this},attach:function(f){f.each(function(h,g){this.push(h,true);if(g==(f.length-1)){this.change()}},this)},remove:function(f){$(f).remove();this.change();return this},reset:function(){this.fpInfo.getElements(".finder-filter-item").each(Element.remove);return this},change:function(){if(!this.fpInfo.getElements(".finder-filter-item").length){this.fp.hide()}else{this.fp.show()}this.fireEvent("change")}})}();
var TreeList=new Class({options:{showStep:3,container:"",checkboxName:false,nodeClass:{clazz:"node",handle:"node-handle",first:"first-node",last:"last-node",close:"node-close",open:"node-open",hasc:"node-hasc",nl:"node-line",icon:"node-icon",name:"node-name",loading:"node-loading",cbox:"node-child-box"},remoteURL:"",remoteParamKey:"p[0]",dataMap:{PID:"parent_id",NID:"cat_id",CNAME:"cat_name",HASC:"isleaf"}},initialize:function(a){$extend(this.options,a);this.container=$(this.options.container);if(!this.container){return}this.initTree()},createNode:function(d){var j=this.options;var c=j.nodeClass;var a=new Element("span",{"class":c.handle}).set({pid:d.PID,nid:d.NID,hasc:d.HASC}).setHTML("&nbsp;");var g=new Element("span",{"class":c.nl}).setHTML("&nbsp;");var i=new Element("input",{type:"checkbox",name:j.checkboxName,value:d.NID,pid:d.PID});var e=new Element("span",{"class":c.icon}).setHTML("&nbsp;");var h=new Element("span",{"class":c.name}).setText(d.CNAME);var b=new Element("span",{"class":c.clazz}).adopt([a,g,i,e,h]);if(!!d.HASC.toInt()){var f=this;a.addClass(c.close);i.set("value",i.get("value")+"|close");a.addEvent("click",function(m){var l=this.getParent("."+c.clazz);if(this.hasClass(c.close)){if(!l.getNext()||l.getNext().getTag()!=="div"){var k=new Element("div",{"class":c.cbox}).injectAfter(l);f.loadNodes(this.get("nid"),k);this.addClass(c.loading);i.set("value",i.get("value").toInt())}else{if(l.getNext()&&l.getNext().getTag()=="div"){l.getNext().show()}}this.removeClass(c.close)}else{if(l.getNext()&&l.getNext().getTag()=="div"){l.getNext().hide();this.addClass(c.close)}}});i.addEvent("click",function(){var l=this.getParent("."+c.clazz);var k=l.getNext();if(k&&k.getTag()=="div"){$ES("input[type=checkbox]",k).set("checked",this.checked==true?true:false)}})}if($E("input[value="+i.get("pid")+"]",this.container)){if($E("input[value="+i.get("pid")+"]",this.container).checked){i.set("checked",true)}}return b},initTree:function(){this.loadNodes(0)},loadNodes:function(b,g){var a;var e=this.options;var f=e.dataMap;new Request.JSON({onRequest:function(){},onSuccess:function(h){var c=this.options;var d=$H(c.dataMap);if($E("span[nid="+b+"]",this.container)){$E("span[nid="+b+"]",this.container).removeClass(c.nodeClass.loading)}h.each(function(k,i){var l={};d.each(function(n,m){l[m]=k[n]});var j=this.createNode(l);if(i==0){j.addClass(c.nodeClass.first)}if(h.length==i+1){j.addClass(c.nodeClass.last)}if(l.HASC.toInt()){j.addClass(c.nodeClass.hasc)}this.addNode(j,g)}.bind(this))}.bind(this)}).get(this.options.remoteURL.substitute({param:this.options.remoteParamKey,value:b})+"&v="+$time())},addNode:function(c,a){if(!a){$(c).inject(this.container)}else{$(c).inject(a)}var b=c.getElement("input[type=checkbox]");if(b&&b.retrieve("check")){b.set("checked",true)}switch(this.options.showStep){case 1:return;case 2:if(!a){$E("."+this.options.nodeClass.handle,c).fireEvent("click")}return;case 3:if(!a||(a&&!a.getParent().hasClass(this.options.nodeClass.cbox))){$E("."+this.options.nodeClass.handle,c).fireEvent("click")}return;case 4:return $E("."+this.options.nodeClass.handle,c).fireEvent("click")}},removeNode:function(){}});var GoodsCatNavTreeList=new Class({Extends:TreeList,createNode:function(e){var c=this.options;c.navURL=c.navURL||"#";var h=c.nodeClass;var g=new Element("span",{"class":h.handle}).set({pid:e.PID,nid:e.NID,hasc:e.HASC}).setHTML("&nbsp;");var b=c.navURL.substitute({cname:e.CNAME,cid:e.NID,cnamelth:e.CNAME.getLength()});b=b.split("filter=");b=b[0]+"filter="+encodeURIComponent(b[1]);var a=new Element("a",{"class":h.name,href:b}).setText(e.CNAME);var d=new Element("span",{"class":h.clazz}).adopt([g,a]);if(e.NID==0){a.setStyle("color","red")}if(!!e.HASC.toInt()){var f=this;g.addClass(h.close);g.addEvent("click",function(k){var j=this.getParent("."+h.clazz);if(this.hasClass(h.close)){if(!j.getNext()||j.getNext().getTag()!=="div"){var i=new Element("div",{"class":h.cbox}).injectAfter(j);f.loadNodes(this.get("nid"),i);this.addClass(h.loading)}else{if(j.getNext()&&j.getNext().getTag()=="div"){j.getNext().show()}}this.removeClass(h.close)}else{if(j.getNext()&&j.getNext().getTag()=="div"){j.getNext().hide();this.addClass(h.close)}}})}return d}});
var mceInstance=new Class({Implements:[Events,Options],options:{acitve:false,maskOpacity:0.5,autoHeight:false,cleanup:true,includeBase:true},initialize:function(a,c){this.seri=a;var b="mce_body_"+a;this.el=$(b);this.setOptions(c);this.input=$E("textarea",this.el).setProperty("ishtml","true");this.frmContainer=$(b+"_frm_container");var d=this;var g=this.options.includeBase;var f=0;var e=this.frm=new Element("iframe",{src:"blank.html?editor",id:b+"_frm",name:b+"_frm",frameborder:0,border:0}).addEvent("load",function(){if(f){return}f=1;var j=d;var k=e.contentWindow;var h="<base href="+SHOPBASE+"/>";var i="<html><head>"+(g?h:"")+'<script>window.onerror=function(){return false;}<\/script><link rel="stylesheet" type="text/css" href="'+SHOPADMINDIR+'wysiwyg_editor.css"/></head><body spellcheck="false" id="'+a+'">'+(j.cleanup(j.input.getProperty("value"))||"&nbsp;")+"</body></html>";k.document.open();k.document.write(i);k.document.close();k.document.designMode="on";k=new Window(k);new Document(k.document).addEvent("mousedown",j.active.bind(j));j.win=k;j.doc=k.document;j.input.setAttribute("filled","true");this.removeEvent("load",arguments.callee)});e.inject(this.frmContainer);this.input.getValue=function(){if(!this.input.getAttribute("filled")){return"textarea-unfilled"}if("textarea"==this.editType){return this.input.value}var h=this.getValue();this.input.value=h;return h}.bind(this);if(this.options.autoHeight){this.autoHeight.call(this)}if($(b)){this.el=$(b).setStyle("visibility","visible")}},autoHeight:function(){try{this.frm.setStyle("height",this.doc.body.offsetHeight+50)}catch(a){}},setValue:function(){this.doc.body.innerHTML=this.input.value},getValue:function(){return this.cleanup(this.doc.body.innerHTML)},regexpReplace:function(e,a,c,d){if(e==null){return e}if(typeof(d)=="undefined"){d="g"}var b=new RegExp(a,d);return e.replace(b,c)},cleanup:function(c){var b="<br/>";var h=[[/(<(?:img|input)[^\/>]*)>/g,"$1 />"]];var a=[[/<li>\s*<div>(.+?)<\/div><\/li>/g,"<li>$1</li>"],[/<span style="font-weight: bold;">(.*)<\/span>/gi,"<strong>$1</strong>"],[/<span style="font-style: italic;">(.*)<\/span>/gi,"<em>$1</em>"],[/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>"],[/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>"],[/<u\b[^>]*>(.*?)<\/u[^>]*>/gi,'<span style="text-decoration: underline;">$1</span>'],[/<p>[\s\n]*(<(?:ul|ol)>.*?<\/(?:ul|ol)>)(.*?)<\/p>/ig,"$1<p>$2</p>"],[/<\/(ol|ul)>\s*(?!<(?:p|ol|ul|img).*?>)((?:<[^>]*>)?\w.*)$/g,"</$1><p>$2</p>"],[/<br[^>]*><\/p>/g,"</p>"],[/<p([^>]*)>(.*?)<\/p>(?!\n)/g,"<p$1>$2</p>\n"],[/<\/(ul|ol|p)>(?!\n)/g,"</$1>\n"],[/><li>/g,">\n\t<li>"],[/([^\n])<\/(ol|ul)>/g,"$1\n</$2>"],[/([^\n])<img/ig,"$1\n<img"],[/^\s*$/g,""]];var g=[[/\s*<br ?\/?>\s*<\/p>/gi,"</p>"]];var f=[[/<br class\="webkit-block-placeholder">/gi,"<br />"],[/<span class="Apple-style-span">(.*)<\/span>/gi,"$1"],[/ class="Apple-style-span"/gi,""],[/<span style="">/gi,""],[/^([\w\s]+.*?)<div>/i,"<p>$1</p><div>"],[/<div>(.+?)<\/div>/ig,"<p>$1</p>"]];var d=[[/<em>\s*<\/em>/gi,""],[/<strong>\s*<\/strong>/gi,""],[/<br\s*\/?>/gi,b],[/<br\/?>\s*<\/(h1|h2|h3|h4|h5|h6|li|p)/gi,"</$1"],[/<p>\s*<br\/?>\s*<\/p>/gi,"<p>\u00a0</p>"],[/<p>(&nbsp;|\s)*<\/p>/gi,"<p>\u00a0</p>"],[/<\/p>\s*<\/p>/g,"</p>"],[/<[^> ]*/g,function(i){return i.toLowerCase()}],[/<[^>]*>/g,function(i){i=i.replace(/ [^=]+=/g,function(j){return j.toLowerCase()});return i}],[/<[^>]*>/g,function(i){i=i.replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"');return i}]];var e=[[/<p>\s*<br ?\/?>\s*<\/p>/gi,"<p>\u00a0</p>"],[/<br>/gi,"<br />"],[/><br ?\/?>/gi,">"],[/<br ?\/?>\s*<\/(h1|h2|h3|h4|h5|h6|li|p)/gi,"</$1"],[/<p>(?:\s*)<p>/g,"<p>"],];d.extend(h);d.extend(a);if(Browser.Engine.webkit){d.extend(f)}d.each(function(i){c=c.replace(i[0],i[1])});c=c.trim();return c},active:function(){if(!this.actived){this.actived=true;this.doc.addEvent("click",function(a){this.fireEvent("docClick",new Event(a))}.bind(this))}this.fireEvent("active",this)},sleep:function(){}});var mceHandler=new Class({Implements:[Events,Options],initialize:function(c,a,b){try{this.el=$(c);$ES("img",this.el).each(function(f){new DropMenu(f)});this.setOptions(b);if(a){if(a.length){a.each(this.addInstance.bind(this))}else{this.addInstance.call(this,a)}}}catch(d){alert(d.message)}if("style_init" in this){this.style_init()}},addInstance:function(a){a.addEvent("active",this.active.bind(this));a.addEvent("docClick",this.docClick.bind(this))},active:function(a){this.inc=a;if(this.inc){this.inc.sleep.call(this.inc)}},docClick:function(b){var a=this.currentEl=b.target||b.srcElement;this.fireEvent("click",b)},getRange:function(){if(!this.inc){return false}if(this.range){return this.range}return window.ie?this.inc.doc.selection.createRange():this.inc.win.getSelection()},getSelection:function(){return window.ie?this.inc.doc.selection:this.inc.win.getSelection()},getRangeText:function(){return window.ie?this.inc.doc.selection.createRange().text:this.inc.win.getSelection().toString()},exec:function(c,b){if(!this.busy){this.busy=true;if(!c||!this.inc){return}if(this.dlg){if(window.ie){if(this.range){this.range.select()}}this.dlg.hide();this.dlg=null}switch(c){case"formatblock":this.inc.doc.execCommand("FormatBlock",false,"<"+b+">");break;case"wrap":this.exec("insertHTML",b[0]+this.getRangetext()+b[1]);break;case"insertHTML":if(window.ie){this.getSelection().clear()}if(this.replaceEl&&this.replaceEl.tagName&&!this.replaceEl.tagName.match(/body/g)){try{var a=this.inc.doc.createElement("div");a.innerHTML=b;a=a.firstChild;this.replaceEl.parentNode.replaceChild(a,this.replaceEl)}catch(d){MessageBox.error(d)}finally{this.replaceEl=null}}else{if(window.ie){this.inc.win.focus();this.range=null;this.getRange().pasteHTML(b)}else{this.inc.doc.execCommand("inserthtml",false,b)}}break;default:try{this.inc.doc.execCommand(c,false,b)}catch(d){MessageBox.error(d)}}this.busy=false}},mklink:function(){if(!this.inc){return}this.replaceEl=null;var a=this.currentEl;var b;if("body"==a.tagName.toLowerCase()&&!this.getRangeText()){return}if(a&&a.tagName&&a.tagName.toLowerCase()=="img"){return MessageBox.error("对不起,目前不支持对已插入图片增加超连接.")}if(a&&a.tagName&&a.tagName.toLowerCase()=="a"){b={text:this.currentEl.innerHTML,href:this.currentEl.href,alt:this.currentEl.alt,title:this.currentEl.title,target:this.currentEl.target};this.replaceEl=a}else{b={text:this.getRangeText()}}this.dialog("link",{height:null,width:450,ajaxoptions:{method:"post",data:b}})},editHTML:function(){var d=this;if(!this.inc){return}var b=$("mce_handle_htmledit_"+this.inc.seri);var a=$("mce_handle_"+this.inc.seri);this.inc.input.getValue();b.show();a.hide();var c=this.inc.frm.getSize();this.inc.input.show();this.inc.frmContainer.hide();b.getElement(".returnwyswyg").addEvent("click",function(){a.show();b.hide();d.inc.doc.body.innerHTML=d.inc.input.value.clean().trim();d.inc.input.hide();d.inc.frmContainer.show();d.inc.editType="wysiwyg";this.removeEvent("click",arguments.callee)});this.inc.editType="textarea"},dialog:function(b,a){if(!this.inc){return}this.inc.win.focus();this.range=null;this.range=this.getRange();a=$cleanNull(a);this.dlg=new Dialog("index.php?ctl=editor&act="+b,$merge(a,{modal:true}));window.curEditor=this},queryValue:function(a,b){if(a=="align"){a="justifyRight"}try{if(b){return this.inc.doc.queryCommandState(a)}else{return this.inc.doc.queryCommandValue(a)}}catch(c){}},queryValues:function(){var a={};var c=["Bold","Italic","Underline","strikeThrough","subscript","superscript","insertOrderedList","insertUnorderedList"];for(var b=0;b<arguments.length;b++){a[arguments[b]]=this.queryValue(arguments[b],c.contains(arguments[b]))}return a}});
var editor_style_1=new Abstract({style_init:function(){this.mce_handle=this.el;this.addEvent("click",this.status.bind(this));this.addEvent("click",function(b){if(!this.$init){this.mce_handle.setOpacity(1);if(this.inc.doc.body.innerHTML.substr(0,6)=="&nbsp;"){this.inc.doc.body.innerHTML=this.inc.doc.body.innerHTML.slice(6)}var a=this;$ES("img",this.mce_handle).addEvent("click",function(){this.inc.win.focus()}.bind(this));$E(".ft_select",this.mce_handle).addEvent("change",function(d){var c=this.getValue();if(!c){return}if(window.ie&&a.range){a.range.select()}a.set("fontName",c)});$E(".fs_select",this.mce_handle).addEvent("change",function(d){var c=this.getValue();if(!c){return}if(window.ie&&a.range){a.range.select()}a.set("fontSize",c)});$$($E(".fontColorPicker",this.el),$E(".fontBGColorPicker",this.el),$E(".ft_select",this.mce_handle),$E(".fs_select",this.mce_handle)).addEvent("click",function(){this.range=null;if(window.ie&&this.getSelection().type.toLowerCase()!="none"){this.range=this.getRange()}if(!window.ie){this.range=this.getRange()}}.bind(this));new GoogColorPicker($E(".fontColorPicker",this.el),{onSelect:function(d,c,f){if(window.ie&&this.range){this.range.select()}this.set("forecolor",d)}.bind(this),onShow:function(c){if(window.ie&&this.range){this.range.select()}}.bind(this)});new GoogColorPicker($E(".fontBGColorPicker",this.el),{onSelect:function(d,c,f){if(window.ie){if(this.range){this.range.select()}return this.set("backColor",d)}this.set("hilitecolor",d)}.bind(this),onShow:function(c){if(window.ie&&this.range){this.range.select()}}.bind(this)})}this.$init=true}.bind(this));this.styler=$ES(".x-section",this.el);this.stylerEl=$ES(".x-style",this.el);this.align=$ES(".x-align",this.el);this.setting=$ES(".x-enable",this.el)},status:function(c){new Event(c);if(!this.target){this.target=c.target.getElementsByTagName("body")[0]||c.target}var b=this.target.style;if(b["background-color"]=="transparent"){b["background-color"]="#fff"}this.styler.setStyle("background-color",(b["background-color"]=="transparent")?"#fff":b["background-color"]);this.stylerEl.setStyle("color",b.color);var a=this.queryValues("Bold","Italic","Underline","strikeThrough","subscript","superscript","align","CreateLink","FontName","FontSize","ForeColor","FormatBlock","insertOrderedList","insertUnorderedList");if(a.align=="center"){this.align[0].parentNode.className="";this.align[1].parentNode.className="in";this.align[2].parentNode.className=""}else{if(a.align=="right"){this.align[0].parentNode.className="";this.align[1].parentNode.className="";this.align[2].parentNode.className="in"}else{if(a.align=="left"){this.align[0].parentNode.className="in";this.align[1].parentNode.className="";this.align[2].parentNode.className=""}else{this.align[0].parentNode.className="";this.align[1].parentNode.className="";this.align[2].parentNode.className=""}}}this.setting.each(function(d){d.parentNode.className=a[d.getAttribute("value")]?"in":""})},set:function(b,a){if(!this.inc||!this.inc.win){return}if(window.ie){this.inc.win.focus()}this.exec(b,a);try{this.status.call(this)}catch(c){}}});
window.onerror=function(a){if(MODALPANEL){MODALPANEL.hide()}};if(!Setting){var Setting={}}Setting.get=function(c,a){return a};var workgroundMarginX=function(){return $("workground").getStyle("margin-left").toInt()+$("workground").getStyle("margin-right").toInt()};function updateSize(){var c=window.mainHeight=window.getSize().y-$("header").getSize().y;var a=window.mainWidth=$("header").getSize().x-(isNaN(workgroundMarginX())?0:workgroundMarginX());window.mainH=c-$("headBar").offsetHeight-$("footBar").offsetHeight;var b=a.limit(1004-(isNaN(workgroundMarginX())?0:workgroundMarginX()),10000);$("main").setStyles({width:b,height:mainH});$("footBar").setStyle("width",b);$("headBar").setStyle("width",b);if(fh=$E("#headBar .finder-header")){fh.setStyle("width",b)}$("sidecontent").setStyle("height",c);$("leftToggler").setStyle("height",c)}var W,task;var getW=function(){return(W&&$type(W)=="object")?W:new ShopEx_AdminXHR()};function showSide(){$(document.body).removeClass("closeLeft");updateSize()}function closeSide(){$(document.body).addClass("closeLeft");updateSize()}window.addEvent("domready",function(){$("leftToggler").addEvents({click:function(a){var a=new Event(a).target;window.setSidePanel=true;if($(document.body).hasClass("closeLeft")){showSide()}else{closeSide()}}});makeAjaksLink(document.body);W=getW();new Ajax("index.php?ctl=dashboard&act=getcertInfo",{data:"t="+new Date().getTime(),update:"CertificateInfo"}).request();new DropMenu("msgRunner");window.addEvent("resize",updateSize)});var extra_validator=[];function __(){}function toggleNode(g){g=new Event(g);var i=$(g.target);if(i.tagName=="IMG"){var c=$(i.get("toggle"));if(c){if(c.style.display=="none"){i.removeClass("x-tnode-close");c.show()}else{i.addClass("x-tnode-close");c.hide()}g.stop()}else{var b=i.get("tree");if(b){i.removeClass("x-tnode-close");var f=i.getParent().get("tid");var a=i.parentNode.parentNode.id+"_"+f;var d=new Element("div",{id:a,"class":"cateloadingbox"}).injectAfter(i.parentNode);var h=new Element("div").setText("loading...").setStyle("padding-left",i.parentNode.getStyle("padding-left").toInt()+20);d.adopt(h);i.set("toggle",a);new Ajax("index.php?ctl=default&act=tnode&p[0]="+b+"&p[1]="+f+"&p[2]="+i.parentNode.get("depth"),{method:"get",update:a,onComplete:function(){makeAjaksLink(a)}}).request()}}}}window.setTab=function(e,b){var d=$("_"+e).getAttribute("url");if(d&&!$(e).getAttribute("url")){W.page(d,{update:e});$(e).setAttribute("url",d)}$(e).style.display="";$("_"+e).addClass("t-handle-current");$("_"+e).removeClass("t-handle");b.each(function(c){$(c).style.display="none";$("_"+c).addClass("t-handle");$("_"+c).removeClass("t-handle-current")})};$E("#header .user_guide").addEvent("click",function(){var a=this;var b;new Request({method:"post",onComplete:function(c){b=c;var d=a.retrieve("step",b);var e=new Element("iframe",{width:710,height:520,src:d,frameborder:0,scrolling:"no",id:"user_guide_iframe",styles:{border:"none",margin:0}}).addEvent("load",function(){return;var j=this.contentWindow;var i=this.contentWindow.document;var g=j.location.href;if(!g.contains("user_guide")){return}$E("#header .user_guide").store("step",j.location.href);$("loadMask").hide();var h=new Elements(i.getElementsByTagName("a"));h=h.filter(function(k){return(!k.getFirst()||k.hasClass("userguidelink"))&&k.get("target")!="_blank"}).addEvent("click",function(k){k.stop();a.store("goUrl",this.href.split("user_guide/")[1]).retrieve("dialog").close()})});var f=new Dialog(e,{title:"ShopEx使用向导",height:570,ajaksable:false,onLoad:function(){if(!window.gecko){e.set("src",d)}},onClose:function(){new Element("div",{styles:{background:"#66CCFF",position:"absolute",overflow:"hidden",zIndex:65535,opacity:0.3,border:"2px #333 dashed"}}).inject(document.body).setStyles(this.dialog.getCis()).effects({duration:800,fps:90}).start(a.getCis()).chain(function(){this.element.remove();if(a.retrieve("goUrl")){W.page(a.retrieve("goUrl"))}a.store("goUrl",false)})}});a.store("dialog",f)}}).post("index.php?ctl=default&act=getcertidandurl")});window.addEvent("load",function(){$E(".container").setStyle("visibility","visible");if(!Browser.Plugins.Flash.version||Browser.Plugins.Flash.version<9){var a;if(Browser.Plugins.Flash.version){a="当前的Flash Player 版本:<strong>"+Browser.Plugins.Flash.version+"."+Browser.Plugins.Flash.build+"</strong>"}else{a="<strong>未安装Flash player 插件.</strong>"}new Dialog(new Element("div").setHTML("<h3 class='error'>",a,"<br/><br/>可能会影响到正常使用.你是否要手动升级安装?</h3>","<a href='http://www.macromedia.com/go/getflashplayer' class='sysiconBtnNoIcon'><strong>是</strong>,我要去下载升级包</a>","<span isCloseDialogBtn='true' class='sysiconBtnNoIcon'><strong>否</strong>,我不想升级</span>"),{title:"Flash Player 可能会引起问题.",resizeable:false,width:450,height:150})}if(!DEBUG_JS&&$("_firebugConsole")){(function(){new Dialog(new Element("div").setHTML("<h3 class='error'>在已知情况下，除非正确配置 Firebug，否则它会使 ShopEx后台 运行缓慢</h3><span class='lnk' isCloseDialogBtn='true'>我知道了!</span>"),{title:"FireBug 使程序变慢.",resizeable:false,width:450,height:150})}).delay(5000)}});window.addEvent("domready",function(){try{window.Xtip=new Tips($("shop_title_block"),{className:"x-tip"});$("shop_title_block").store("tip:title","网店名称:-(点击进行设置)");$("shop_title_block").store("tip:text",$("shop_title_block").subText(25));setInterval("if($('elTempBox')&&$('elTempBox').getElements('*').length)$('elTempBox').empty()",2*60000);var c;var a=[];if(window.ie){c=document.body}else{c=window}c.focus();c.addEvent("keydown",function(i){if(i.code==27){$E(".finder-search-input")?$E(".finder-search-input").blur():false;c.focus()}if(["INPUT","TEXTAREA"].contains(i.target.tagName)){return}if(i.shift&&i.code==191){return new Dialog("shortcut_key_help.html",{title:"快捷键",ajaksable:false,width:window.getSize().x*0.7,height:window.getSize().y*0.7})}var f=new Hash({t49:"top-tab-goods",t50:"top-tab-order",t51:"top-tab-member",t52:"top-tab-sale",t53:"top-tab-site",t54:"top-tab-analytics"});var h="t"+i.code;if(i.alt&&f.getKeys().contains(h)){return $(f[h]).fireEvent("click",{stop:$empty})}switch(i.code){case 27:var g=$$(".dialog");if(g.length){return g.getLast().retrieve("instance").close()}if(MODALPANEL.isDisplay()){return MODALPANEL.hide()}for(cf in finderGroup){return finderGroup[cf].detail.fireEvent("slideOut")}break;case 82:if(i.control){return}var d=historyManager.getHash();W.page("index.php?"+(d?d:"ctl=dashboard&act=index"));break;case 85:$(document.body).toggleClass("closeLeft");updateSize();break;case 191:i.stop();return $E(".finder-search-input")?$E(".finder-search-input").focus():false;case 72:return $E("#header .user_guide").fireEvent("click",{stop:$empty})}a.push(i.code);if(a.toString().indexOf("38,38,40,40,37,37,39,39,66,65")>-1){new Dialog("google_gears.html",{title:"利用Gears加速ShopEx后台",ajaksable:false});a=[]}})}catch(b){alert(b)}});(function(){if(window.google&&google.gears){return}var a=null;if(typeof GearsFactory!="undefined"){a=new GearsFactory()}else{try{a=new ActiveXObject("Gears.Factory");if(a.getBuildInfo().indexOf("ie_mobile")!=-1){a.privateSetGlobalObject(this)}}catch(b){if((typeof navigator.mimeTypes!="undefined")&&navigator.mimeTypes["application/x-googlegears"]){a=document.createElement("object");a.style.display="none";a.width=0;a.height=0;a.type="application/x-googlegears";document.documentElement.appendChild(a)}}}if(!a){return}if(!window.google){google={}}if(!google.gears){google.gears={factory:a}}})();void function(){if(window.google&&google.gears){var a=$E("#header .top-link-menu").setStyle("width",320);var b=a.getElement(".gearsIco").show();b.store("tip:text","当前浏览器支持<b>Gears</b><sup>Powered By Google</sup><br/><br/><b>Gears</b>可以同步远程资源到本地，使程序加载运行更迅速。");new Tips(b,{className:"x-tip"});b.addEvent("click",function(c){c.stop();new Dialog("google_gears.html",{title:"利用Gears加速ShopEx后台",ajaksable:false})})}}();
