void function(){var a;DropMenu=new Class({options:{periodical:false,delay:500,postvar:"finderItems",varname:"items",height:250,relative:window,offset:{x:0,y:0}},initialize:function(c,b){var c=$(c);if(!c){return}b=$extend(this.options,b);var d=$(b.menu)||$(c.get("dropmenu"));if(!d){return}c.addEvent("click",function(g){if($(g.target).get("dropfor")){g.stopPropagation()}if("x_btn_finder-tag"==this.get("id")){$("finder-tag").fireEvent("show")}g=$(this.get("dropfor"))||this;g.blur();if(g.hasClass("droping")){g.removeClass("droping");return d.hide()}g.addClass("droping");g.fireEvent("dropmenu",{type:"dropmenu",target:g,menu:d});var f=g.getPosition(b.relative);if(!d.get("initEd")){d.setStyles({display:"block",visibility:"hidden","overflow-y":"auto"});d.set("initEd","1");if(d.offsetHeight>b.height){d.setStyle("height",b.height)}d.setStyle("visibility","visible")}d.setStyles({left:f.x+b.offset.x,top:f.y+g.getSize().size.y+b.offset.y,display:"block"});d.store("drophandle",g);(function(){document.body.addEvent("click",function(){d.retrieve("drophandle").removeClass("droping");if(d.setStyle){d.setStyle("display","none")}this.removeEvent("click",arguments.callee)})}).delay(100)})}})}();
var MessageBox=new Class({options:{delay:1,onFlee:$empty,FxOptions:{}},initialize:function(c,b,a){$extend(this.options,a);this.createBox(c,b)},flee:function(d){if(window.MessageBoxOnShow){window.MessageBoxOnShow(d,d.hasClass("success"));window.MessageBoxOnShow=$empty()}var a=new Fx.Styles(d,this.options.FxOptions);var b=false;var c=this;d.addEvent("click",function(){this.hide()});(function(){b=true;a.start({left:0,opacity:0}).chain(function(){this.element.remove();b=false;if(c.options.onFlee){c.options.onFlee.apply(c,[c])}if(window.MessageBoxOnFlee){window.MessageBoxOnFlee(d,d.hasClass("success"));window.MessageBoxOnFlee=$empty()}})}).delay(this.options.delay*1000)},createBox:function(e,a){var f=/<h4[^>]*>([\s\S]*?)<\/h4>/;var c=e;if(c.test(f)){c.replace(f,function(){e=arguments[1];return""})}var b=new Element("div").setStyles({position:"absolute",visibility:"hidden",width:200,height:"auto",opacity:0,zIndex:65535}).inject(document.body);var d=this;b.addClass(a).setHTML("<h4>",e,"</h4>").amongTo(window).effect("opacity").start(1).chain(function(){d.flee(this.element)});return b}});MessageBox.success=function(b,a){return new MessageBox(b||"操作成功!","success",a)};MessageBox.error=function(b,a){a=a||{};if(!a.delay){a.delay=3}return new MessageBox(b||"操作失败!","error",a)};MessageBox.show=function(b,a){if(b.contains("failedSplash")){return new MessageBox(b||"操作失败!","error",a)}return new MessageBox(b||"操作成功!","success",a)};
(function(){var b;var a=function(){if(b){return b}var c={WM:["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],aN:["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],XM:["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc","#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd","#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0","#cc0000","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79","#990000","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47","#660000","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]};var d='<div class="goog-palette"><table cellspacing="0" cellpadding="0"  class="goog-palette-table"><tbody class="goog-palette-body">';var f="</tbody></table></div>";var e="";$H(c).each(function(g,h){e+=d;g.each(function(i,k){var j=i.hexToRgb();if(k==0){e+='<tr class="goog-palette-row">'}e+='<td class="goog-palette-cell"><div title="'+j+'" style="background-color: '+j+';" class="goog-palette-colorswatch"/></td>';if((k+1)%8==0){if((k+1)==g.length){e+="</tr>"}else{e+='</tr><tr class="goog-palette-row">'}}});e+=f});b=e;return e};GoogColorPicker=new Class({Implements:[Events,Options],options:{onSelect:Class.empty,onShow:Class.empty,offsets:{x:10,y:10}},initialize:function(d,c){this.setOptions(c);this.el=$(d);this.showing=false;var e=this;this.el.addEvents({click:function(f){e.showPanel(f)},mouseleave:function(){e.selecting=false;e.blurEl()},mouseenter:function(){e.selecting=true}})},onSelect:function(c,d){this.fireEvent("select",[d,c,this.el]);this.selecting=false;this.hidePanel()},blurEl:function(){this.hd=this.hidePanel.delay(850,this)},position:function(f){var d=window.getSize(),c=window.getScroll();var g={x:this.gcp_panel.offsetWidth,y:this.gcp_panel.offsetHeight};var e={x:"left",y:"top"};for(var h in e){var i=f.page[h]+this.options.offsets[h];if((i+g[h]-c[h])>d[h]){i=f.page[h]-this.options.offsets[h]-g[h]}this.gcp_panel.setStyle(e[h],i)}},hidePanel:function(){if(this.selecting){return}if(this.gcp_panel){this.gcp_panel.setStyle("visibility","hidden")}},showPanel:function(e){var d=this;var c=this.el.uid||Native.UID++;if(!$("gcp_panel"+c)){var f=this.gcp_panel=$("gcp_panel"+c)||new Element("div",{id:"gcp_panel"+c,"class":"goog-palette-panel"}).setHTML(a()).inject($("tabernacle"));f.addEvents({mousemove:function(){d.selecting=true},mouseleave:function(){d.selecting=false;d.blurEl()}});$ES(".goog-palette-cell",f).addEvents({mouseover:function(g){this.addClass("goog-palette-cell-hover")},mouseleave:function(g){this.removeClass("goog-palette-cell-hover")},click:function(i){var g=this.getElement(".goog-palette-colorswatch").get("title");var h=g.rgbToHex();d.onSelect(g,h)}})}this.position(e);this.fireEvent("show",this.el,this);this.gcp_panel.setStyle("visibility","visible")}})})();
function getContent(a){return $(a).getParent(".dialogContent")||$(a).getParent(".main_content")||document.body}var DatePickers=new Class({Implements:[Events,Options],options:{onShow:function(a){a.setStyle("visibility","visible")},onHide:function(a){a.setStyle("visibility","hidden").setStyle("left",-300)},showDelay:100,hideDelay:100,className:"x-calendar",offsets:{x:0,y:20},dateformat:"-",days:["SUN","MON","TUE","WED","THU","FIR","STA"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],weekFirstDay:1},initialize:function(){var c=Array.link(arguments,{options:Object.type,elements:$defined});this.setOptions(c.options||null);this.lock=false;this.datepicker=new Element("div").addEvents({mouseover:function(){this.lock=true}.bind(this),mouseout:function(){this.lock=false}.bind(this)}).inject($("tabernacle"));if(this.options.className){this.datepicker.addClass(this.options.className)}var b=new Element("div",{"class":"x-datepicker-top"}).inject(this.datepicker);this.container=new Element("div",{"class":"x-datepicker"}).inject(this.datepicker).addEvent("click",function(d){d.stopPropagation()});var a=new Element("div",{"class":"x-datepicker-bottom"}).inject(this.datepicker);this.datepicker.setStyles({position:"absolute",top:0,left:0,visibility:"hidden",zIndex:65535});if(c.elements){c.elements.each(function(d){d.store("bindColorPicker",true)});this.attach(c.elements)}},attach:function(a){$$(a).each(function(c){var b=c.retrieve("datepicker:dateformat",c.get("accept"));if(!b){b=this.options.dateformat;c.store("datepicker:dateformat",b)}var f=c.retrieve("datepicker:datevalue",c.get("value"));if(!f){f=this.format(new Date(),b);c.store("datepicker:datevalue",f)}c.store("datepicker:current",this.unformat(f,b));var d=c.retrieve("datepicker:focus",this.elementFocus.bindWithEvent(this,c));var e=c.retrieve("datepicker:blur",this.elementBlur.bindWithEvent(this,c));c.addEvents({focus:d,blur:e});c.store("datepicker:native",c.get("accept"));c.erase("dateformat")},this);return this},detach:function(a){$$(a).each(function(c){c.removeEvent("onfocus",c.retrieve("datepicker:focus")||$empty);c.removeEvent("onblur",c.retrieve("datepicker:blur")||$empty);c.eliminate("datepicker:focus").eliminate("datepicker:blur");var b=c.retrieve("datepicker:native");if(b){c.set("dateformat",b)}});return this},elementFocus:function(b,a){this.el=a;var c=a.retrieve("datepicker:current");this.curFullYear=c[0];this.curMonth=c[1];this.curDate=c[2];this.build();this.timer=$clear(this.timer);this.timer=this.show.delay(this.options.showDelay,this);this.position({page:a.getPosition()})},elementChange:function(){this.el.store("datepicker:current",Array(this.curFullYear,this.curMonth,this.curDate));this.el.set("value",this.format(new Date(this.curFullYear,this.curMonth,this.curDate),this.el.retrieve("datepicker:dateformat")));$clear(this.timer);this.timer=this.hide.delay(this.options.hideDelay,this)},elementBlur:function(a){if(!this.lock){$clear(this.timer);this.timer=this.hide.delay(this.options.hideDelay,this)}},position:function(d){var b=window.getSize(),a=window.getScroll();var e={x:this.datepicker.offsetWidth,y:this.datepicker.offsetHeight};var c={x:"left",y:"top"};for(var f in c){var g=d.page[f]+this.options.offsets[f];if((g+e[f]-a[f])>b[f]){g=d.page[f]-this.options.offsets[f]-e[f]}this.datepicker.setStyle(c[f],g)}if(window.ie){}},show:function(){this.fireEvent("show",this.datepicker)},hide:function(){this.fireEvent("hide",this.datepicker)},build:function(){$A(this.container.childNodes).each(Element.dispose);var c=new Element("table").set({cellpadding:"0",cellspacing:"0"}).inject(this.container);var a=this.caption().inject(c);var d=this.thead().inject(c);var b=this.tbody().inject(c)},navigate:function(b,c){switch(b){case"m":var a=this.curMonth+c;if(a<0||a==12){this.curMonth=(a<0)?11:0;this.navigate("y",c)}else{this.curMonth=a}break;case"y":this.curFullYear+=c;break}this.el.store("datepicker:current",Array(this.curFullYear,this.curMonth,this.curDate));this.el.focus()},caption:function(){var a={prev:{month:true,year:true},next:{month:true,year:true}};var b=new Element("caption");var e=new Element("a").addClass("prev").appendText("\x3c");var d=new Element("a").addClass("next").appendText("\x3e");var c=new Element("span").addClass("year").inject(b);if(a.prev.year){e.clone().addEvent("click",function(){this.navigate("y",-1)}.bind(this)).inject(c)}new Element("span").set("text",this.curFullYear).addEvent("mousewheel",function(g){g.stop();this.navigate("y",(g.wheel<0?-1:1));this.build()}.bind(this)).inject(c);if(a.next.year){d.clone().addEvent("click",function(){this.navigate("y",1)}.bind(this)).inject(c)}var f=new Element("span").addClass("month").inject(b);if(a.prev.month){e.clone().addEvent("click",function(){this.navigate("m",-1)}.bind(this)).inject(f)}new Element("span").set("text",this.options.months[this.curMonth]).addEvent("mousewheel",function(g){g.stop();this.navigate("m",(g.wheel<0?-1:1));this.build()}.bind(this)).inject(f);if(a.next.month){d.clone().addEvent("click",function(){this.navigate("m",1)}.bind(this)).inject(f)}return b},thead:function(){var b=new Element("thead");var a=new Element("tr").inject(b);for(i=0;i<7;i++){new Element("th").set("text",this.options.days[(this.options.weekFirstDay+i)%7].substr(0,3)).inject(a)}return b},tbody:function(){var j=new Date(this.curFullYear,this.curMonth,1);var e=((j.getDay()-this.options.weekFirstDay)+7)%7;var m=new Date(this.curFullYear,this.curMonth+1,0).getDate();var c=new Date(this.curFullYear,this.curMonth,0).getDate();var n=(this.el.get("value"))?this.unformat(this.el.get("value"),this.el.retrieve("datepicker:dateformat")):false;var h=new Date(n[0],n[1],n[2]).getTime();var j=new Date();var k=new Date(j.getFullYear(),j.getMonth(),j.getDate()).getTime();var g=new Element("tbody");g.addEvent("mousewheel",function(d){d.stop();this.navigate("m",(d.wheel<0?-1:1));this.build()}.bind(this));for(var f=1;f<43;f++){if((f-1)%7==0){tr=new Element("tr").inject(g)}var b=new Element("td").inject(tr);var l=f-e;var a=new Date(this.curFullYear,this.curMonth,l);if(l<1){l=c+l;b.addClass("inactive")}else{if(l>m){l=l-m;b.addClass("inactive")}else{if(a.getTime()==h){b.addClass("hilite")}else{if(a.getTime()==k){b.addClass("today")}}b.addEvents({click:function(d){this.curDate=d;this.elementChange()}.bind(this,l),mouseover:function(d){d.addClass("hilite")}.bind(this,b),mouseout:function(o,d){if(d.getTime()!=h){o.removeClass("hilite")}}.bind(this,[b,a])}).addClass("active")}}b.set("text",l)}return g},unformat:function(d,b){var a=d.split(b);var c=new Array(3);if(a.length<3||!a[0]||!a[1]||!a[2]){return[new Date().getFullYear(),new Date().getMonth(),new Date().getDate()]}c[0]=a[0].toInt();c[1]=a[1].toInt()-1;c[2]=a[2].toInt();return c},format:function(d,g){if(d){var c=d.getDate();var b=d.getDay();var a=this.options.days[b];var k=d.getMonth()+1;var e=this.options.months[k-1];var h=d.getFullYear()+"";return[h,k,c].join(g)}else{return""}}});Element.extend({makeCalable:function(a){if(this.retrieve("bindColorPicker")){return}return new DatePickers([this],a)}});
var validatorMap=new Hash({required:["本项必填",function(b,a){return a!=null&&a!=""&&a.trim()!=""}],number:["请录入数值",function(b,a){return a==null||a==""||!isNaN(a)&&!/^\s+$/.test(a)}],params1:["参数名中不能含有单引号或双引号",function(b,a){return !/(?:\"|\')/.test(a)}],params2:["参数组名称中不能含有单引号或双引号",function(b,a){return !/(?:\"|\')/.test(a)}],msn:["请输入MSN",function(b,a){return a==null||a==""||/\S+@\S+/.test(a)}],skype:["请输入Skype",function(b,a){return a==null||a==""||!/\W/.test(a)||/^[a-zA-Z0-9]+$/.test(a)}],digits:["请录入整数",function(b,a){return a==null||a==""||!/[^\d]/.test(a)}],unsignedint:["请录入正整数",function(b,a){return a==null||a==""||(!/[^\d]/.test(a)&&a>0)}],unsigned:["请输入大于等于0的数值",function(b,a){return a==null||a==""||(!isNaN(a)&&!/^\s+$/.test(a)&&a>=0)}],positive:["请输入大于0的数值",function(b,a){return a==null||a==""||(!isNaN(a)&&!/^\s+$/.test(a)&&a>0)}],alpha:["请录入英文字母",function(b,a){return a==null||a==""||/^[a-zA-Z]+$/.test(a)}],alphaint:["请录入英文字母或者数字",function(b,a){return a==null||a==""||!/\W/.test(a)||/^[a-zA-Z0-9]+$/.test(a)}],alphanum:["请录入英文字母、中文及数字",function(b,a){return a==null||a==""||!/\W/.test(a)||/^[\u4e00-\u9fa5a-zA-Z0-9]+$/.test(a)}],date:["请录入日期格式yyyy-mm-dd",function(b,a){return a==null||a==""||/^(19|20)[0-9]{2}-([1-9]|0[1-9]|1[012])-([1-9]|0[1-9]|[12][0-9]|3[01])+$/.test(a)}],email:["请录入正确的Email地址",function(b,a){return a==null||a==""||/\S+@\S+/.test(a)}],text:["",function(b,a){return true}],select:["",function(b,a){return true}],radio:["",function(b,a){return true}],checkbox:["",function(b,a){return true}],url:["请录入正确的网址",function(b,a){return a==null||a==""||/^(http|https|ftp):\/\/([A-Z0-9][A-Z0-9_-]*)(:(\d+))?\/?/i.test(a)}],area:["请选择完整的地区",function(b,a){return b.getElements("select").every(function(d){var c=d.getValue();return c!=""&&c!="_NULL_"})}],requiredcheckbox:["必须选择一项",function(b){var a=b.getParent().getElements("input[type=checkbox]");a.removeEvents("change").addEvent("change",function(){if(validator.test(b.form,b)){validator.removeCaution(b)}});return a.some(function(c){return c.checked})}]});var validator=new Abstract({test:function(b,g){b=b||$(document.body);g=$(g);if(g.get("type")=="hidden"){if(!g.getParent().isDisplay()){return true}}else{if(!g.isDisplay()&&g.get("vtype")!="checkForm"){return true}}this.bindBlurWithValidator(b,g);var l=[],j=g.get("required"),f=g.get("vtype"),k=g.get("caution");var d=b?b.get("extra"):false;if(f&&f.contains("&&")){f=f.split("&&")}if(j){l.include("required")}if(!!f){l.include(f)}l=l.flatten();var a=l.every(function(o){var p=true;var n=validatorMap.get(o)||window[o];if(!n){return p}var q=k||n[0];var m=n[1];if($type(m)=="function"){p=m(g,g.getValue())}if(!p){this.showCaution(g,q)}return p},this);if(!a){return false}if(d&&extra_validator){var i=extra_validator[d];if(!i){return true}var e=i[f];if(!e){return true}var h=e[0];var c=e[1];if(!c(b,(g.getVlaue?g.getVlaue():g))){this.showCaution(g,h);return false}}return true},showCaution:function(a,c){var b=$(a).getNext();if(b&&b.get("name")&&b.get("name").contains("validationMsgBox")){return}if(!c||c.trim()==""){return}new Element("div",{"class":"x-vali-error",name:"validationMsgBox",html:c}).injectAfter(a)},removeCaution:function(a){var b=$(a).getNext();if(b&&b.get("name")&&b.get("name").contains("validationMsgBox")){return b.remove()}},bindBlurWithValidator:function(c,a){var b=$$(a,a.getFormElements());b.removeEvents("blur").addEvent("blur",function(){this.removeCaution(a);this.test(c,a)}.bind(this))}});
var Tags_opt=new Class({initialize:function(a,b){this.finderTag=a.finderTag;if(!this.finderTag){return}this.tagEvent();this.sigId=b;this.applyObj=$E(".btn-apply",$("finder-tag"));this.createObj=$E(".btn-create-tag",$("finder-tag"));this.manage=$E(".btn-tag-manage",$("finder-tag"));this.taginput=$E(".tag-editor-value",$("finder-tag"));this.tagmain=$E(".tag-editor-group",$("finder-tag"));this.url=a.url;this.bindEvent()},filterUrl:function(a){if(!this.url){return"index.php"+location.search.split("&")[0]+"&act="+a}return this.url+"&act="+a},bindEvent:function(){if(this.taginput){this.taginput.addEvent("click",function(a){a.stopPropagation()})}if(this.applyObj){this.applyObj.addEvent("click",function(a){this.finderTag.fireEvent("apply")}.bind(this))}if(this.createObj){this.createObj.addEvent("click",function(a){this.newDialog()}.bind(this))}},bindTagEvent:function(a){a.addEvent("click",function(c){c.stop();if(!this.hasClass("selected_all")){var b=$E("ul[class=theme_tag] li[class=selected_all]").clone();b.getFirst().replaces(this.getFirst());this.removeClass("selected_none");this.removeClass("selected_part");this.addClass("selected_all")}else{var b=$E("ul[class=theme_tag] li[class=selected_none]").clone();b.getFirst().replaces(this.getFirst());this.removeClass("selected_all");this.addClass("selected_none")}})},newDialog:function(){var a=this;new Dialog(this.finderTag.getElement(".dialogTag").clone(),{width:350,height:200,title:"新建标签",onLoad:function(){this.dialog.getElement(".dialogTag").setStyle("display","block");this.dialog.getElement(".btnSmt").addEvent("click",function(){if($type(a.finderTag.fireEvent)!="function"){this.close();return}a.finderTag.fireEvent("createTag",this)}.bind(this));this.dialog.getElement(".btnCancel").addEvent("click",function(){this.close()}.bind(this));this.dialog.getElement(".tag-editor-value").addEvent("keydown",function(b){if(b.code==13){this.getElement(".btnSmt").fireEvent("click")}}.bind(this.dialog))}})},selectedRow:function(){if($("headBar")&&$("headBar").getChildren("form")[0]&&$("headBar").getChildren("form")[0].retrieve("rowselected")){this.key=$H($("headBar").getChildren("form")[0].retrieve("rowselected")).getKeys()[0];this.value=$H($("headBar").getChildren("form")[0].retrieve("rowselected")).getValues()[0]}if(this.value&&this.value.length<1){this.value=null;this.key=null}},filterParam:function(){var b=new String;var a=/\w+(?=\/)/.exec(location.search);if(this.sigId){b="&"+a+"_id[]="+this.sigId}else{if(this.value&&this.value.contains("_ALL_")){return b="&"+this.key+"=_ALL_"}if(this.value){this.value.each(function(c){b+="&"+this.key+"="+c}.bind(this))}}return b},toQueryString:function(){var d=this.finderTag.getElement("ul[class=tag-editor-group]").getElements("li");var c=[],b=[];d.each(function(e){if(e.hasClass("selected_all")){c.include(e)}if(e.hasClass("selected_part")){b.include(e)}});var a="_SET_TAGS_=";c.each(function(f){var e=f.get("text").trim();a+="_S_ALL"+e+" "});b.each(function(f){var e=f.get("text").trim();a+="_S_PAR"+e+" "});return a},tagEvent:function(){var a=this;this.finderTag.addEvents({show:function(){a.tagmain.setStyle("overflow","hidden");this.setStyle("overflow","hidden");a.selectedRow();var c=a.filterParam();thistag=this;var b=a.filterUrl("tagList");if(!c.length){c=null}new Request({method:"post",url:b,onSuccess:function(f){var h=JSON.decode(f);if(!h){return}thistag.getElement("ul[class=tag-editor-group]").empty();if(h.length>10){a.tagmain.setStyles({"overflow-y":"auto",height:"200px"})}for(var g=0;g<h.length;g++){var e=h[g]["status"];var d=$E("ul[class=theme_tag] li[class=selected_"+e+"]").clone();d.appendText(h[g]["tag_name"]);d.inject(thistag.getElement("ul[class=tag-editor-group]"))}var j=thistag.getElement("ul[class=tag-editor-group]").getElements("li");a.bindTagEvent(j)}}).send(c)},apply:function(d){var c=a.filterUrl("setTag");a.selectedRow();if(!a.url&&!a.sigId&&!d){return}if(!a.value&&a.url){MessageBox.error("请选择要操作的项");return}var b=a.toQueryString();if(d){a.sigId=d}var e=a.filterParam();b+=e;W.page(c,{update:"messagebox",method:"post",data:b,onComplete:function(){if(a.url){for(var g in finderGroup){finderGroup[g].refresh()}}$("loadMask").hide()}})},createTag:function(c){var e=c.dialog.getElement(".tag-editor-value").get("value").trim();if(e.contains(" ")||e.length==0){MessageBox.error("标签名不能为空且其中不能有空格符号!");return}var d=this.getElement("ul[class=tag-editor-group]").getElements("li");if(d.some(function(f){return f.get("text").trim()==e})){MessageBox.error("此标签已存在");return}var b=a.filterUrl("newTag");thistag=this;W.page(b,{update:"messagebox",method:"post",data:"tag_name="+e,onComplete:function(g){c.close();a.selectedRow();var f=(a.sigId||a.value&&a.value.length>0)?$E("ul[class=theme_tag] li[class=selected_all]").clone():$E("ul[class=theme_tag] li[class=selected_none]").clone();f.appendText(e);f.inject(thistag.getElement("ul[class=tag-editor-group]"));a.bindTagEvent(f);if(a.value&&a.value.length||a.sigId){a.finderTag.fireEvent("apply")}}})}})}});
(function(){var c,b;var a=function(d){if(!d){if(undefined!=c){return c}c=$("dialogProtoType").innerHTML;$("dialogProtoType").remove();return c}if(undefined!=b){return b}b=$("frameDialogProtoType").innerHTML;$("frameDialogProtoType").remove();return b};Dialog=new Class({Implements:[Options,Events],options:{onShow:$empty,onHide:$empty,onClose:$empty,onLoad:$empty,callback:false,frameable:false,width:750,height:400,dialogBoxWidth:10,title:"",dragable:true,resizeable:true,ajaksable:true,singlon:true,modal:false,ajaxoptions:{update:false,evalScripts:true,method:"get",autoCancel:true}},initialize:function(f,e){var d=this.currentRegionDialogs=$$(".dialog");if(d.some(function(i,h){if(i.retrieve("serial")==f.toString().trim()&&i.style.display!="none"){i.inject(document.body);return true}})){return}this.setOptions(e);e=this.options;this.UID=(Native.UID)++;var g=a(this.options.frameable);this.dialog=new Element("div",{id:"dialog_"+this.UID,"class":"dialog",styles:{visibility:"hidden",zoom:1,opacity:0,zIndex:65534}}).setHTML(g).inject(document.body).store("serial",f.toString().trim());if(this.options.callback){this.dialog.store("callback",this.options.callback)}this.dialog_head=$E(".dialog-head",this.dialog).addEvent("click",function(h){if($$(".dialog").length>1){this.inject(document.body)}}.bind(this.dialog));this.dialog_body=$E(".dialog-content-body",this.dialog);$E(".dialog-title",this.dialog_head).setText(e.title||"Dialog");$E(".dialog-btn-close",this.dialog_head).addEvents({click:function(h){if(h){h=new Event(h).stop()}this.close()}.bind(this),mousedown:function(h){new Event(h).stop()}});if(e.dragable){this.dragDialog()}if(e.resizeable){this.dialog_body.makeResizable({handle:$E(".dialog-btn-resize",this.dialog),limit:{x:[200,window.getSize().x*0.9],y:[100,Math.max(window.getSize().y,window.getScrollSize().y)]},onDrag:function(){this.setDialogWidth()}.bind(this)})}else{$E(".dialog-btn-resize",this.dialog).hide()}$extend(e.ajaxoptions,{update:this.dialog_body,elMap:{".mainHead":$E(".dialog-content-head",this.dialog),".mainFoot":$E(".dialog-content-foot",this.dialog)},onRequest:function(){this.setDialog_bodySize()}.bind(this),onFailure:function(){this.close();alert("加载弹出内容失败!")}.bind(this),onComplete:function(h){if("onComplete" in e){e.onComplete(h)}this.onLoad.call(this,h)}.bind(this)});this.popup(f,e)},onLoad:function(e){var d=$E("*[isCloseDialogBtn]",this.dialog);if(d){d.addEvent("click",this.close.bind(this))}this.dialog.store("instance",this);this.show()},initContent:function(g,f,h){f=f||this.options;var j=this;if(!h){var d=arguments.callee;this.reload=function(){d(g,f,true)}}if(f.frameable){this.dialog_body.set("src",g).addEvent("load",function(){j.onLoad.call(j,this)});return}if($type(g)=="string"){if(f.ajaksable){W.page(g,f.ajaxoptions)}else{new Ajax(g,f.ajaxoptions).request()}}else{try{this.dialog_body.empty().adopt(g)}catch(i){this.dialog_body.setHTML("内容加载失败.!")}if(!h){this.onLoad.call(this)}}},popup:function(e,d){if(d.modal||d.singlon){MODALPANEL.show()}$("loadMask").amongTo(window).show();this.fireEvent("onShow",this);this.initContent(e,d)},show:function(){this.setDialog_bodySize();$("loadMask").hide();var d=this.currentRegionDialogs;var e=d?d.length:0;if(e&&e>0){this.dialog.position($H(d[e-1].getPosition()).map(function(f){return f+=20})).setOpacity(1)}else{this.dialog.amongTo(window)}this.fireEvent("onLoad",this)},close:function(){try{this.fireEvent("onClose",this.dialog)}catch(d){}this.dialog.style.display="none";if(window.ie){$ES("iframe",this.dialog_body).remove()}this.dialog.empty().remove();$("dialogdragghost_"+this.UID)?$("dialogdragghost_"+this.UID).remove():"";if(this.currentRegionDialogs.length>0){return false}MODALPANEL.hide();return"nodialog"},hide:function(){this.fireEvent("onHide");this.close.call(this)},setDialog_bodySize:function(){this.dialog_body.setStyles({height:this.options.height-this.dialog_head.getSize().size.y-this.options.dialogBoxWidth*2,width:this.options.width-this.options.dialogBoxWidth*2});this.setDialogWidth()},setDialogWidth:function(){this.dialog.setStyle("width",this.dialog_body.getSize().size.x+this.options.dialogBoxWidth*2)},dragDialog:function(){var d=this.dialog;var e=new Element("div",{id:"dialogdragghost_"+this.UID});e.setStyles({position:"absolute",border:"2px #333333 dashed",cursor:"move",background:"#66CCFF",display:"none",opacity:0.3,zIndex:65535}).inject(document.body);this.addEvent("load",function(f){e.setStyles(d.getCis())});new Drag(e,{handle:this.dialog_head,limit:{x:[0,window.getSize().x],y:[0,window.getSize().y]},onStart:function(){e.setStyles(d.getCis());e.show()},onComplete:function(){var f=e.getPosition();d.setStyles({top:f.y,left:f.x});e.hide()}})}})})();
function selectArea(a,j,e){var a=$(a);if(!a){return}var c=a.value;var f=a.getParent();var g=a.getNext();var h=a.getParent("*[package]");var i=h.getElement("input[type=hidden]");var d=function(m){var n=[];var l=true;var k=$ES("select",h);k.each(function(o){if(o.getValue()!="_NULL_"&&l){n.push($(o.options[o.selectedIndex]).get("text"))}else{l=false}});if(m.value!="_NULL_"){$E("input",h).value=h.get("package")+":"+n.join("/")+":"+m.value}else{$E("input",h).value=function(p){var o=k.indexOf(p)-1;if(o>=0){return h.get("package")+":"+n.join("/")+":"+k[o].value}return""}(m)}};if(c=="_NULL_"&&g&&(g.getTag()=="span"&&g.hasClass("x-areaSelect"))){a.nextSibling.empty();d(a)}else{var b=$(a.options[a.selectedIndex]);if(b.get("has_c")){new Request({onSuccess:function(k){if(g&&(g.getTag()=="span"&&g.hasClass("x-region-child"))){var l=g}else{var l=new Element("span",{"class":"x-region-child"}).inject(f)}d(a);if(k){l.set("html",k);if(i){i.retrieve("sel"+e,$empty)();i.retrieve("onsuc",$empty)()}}else{a.getAllNext().remove();d(a);i.retrieve("lastsel",$empty)(a)}}}).get("index.php?ctl=default&act=sel_region&p[0]="+j+"&p[1]="+e);if($("shipping")){$("shipping").setText("")}}else{a.getAllNext().remove();d(a);if(!b.get("has_c")&&b.value!="_NULL_"){i.retrieve("lastsel",$empty)(a)}}}};
Swiff.Uploader=new Class({Extends:Swiff,Implements:Events,options:{path:"Swiff.Uploader.swf",target:null,zIndex:9999,height:30,width:100,callBacks:null,params:{wMode:"opaque",menu:"false",allowScriptAccess:"always"},typeFilter:null,multiple:true,queued:true,verbose:false,url:null,method:null,data:null,mergeData:true,fieldName:null,fileSizeMin:1,fileSizeMax:null,allowDuplicates:false,timeLimit:(Browser.Platform.linux)?0:30,buttonImage:null,policyFile:null,fileListMax:0,fileListSizeMax:0,instantStart:false,appendCookieData:false,fileClass:null},initialize:function(b){this.addEvent("load",this.initializeSwiff,true).addEvent("select",this.processFiles,true).addEvent("complete",this.update,true).addEvent("fileRemove",function(d){this.fileList.erase(d)}.bind(this),true);this.setOptions(b);if(this.options.callBacks){Hash.each(this.options.callBacks,function(e,d){this.addEvent(d,e)},this)}this.options.callBacks={fireCallback:this.fireCallback.bind(this)};var c=this.options.path;if(!c.contains("?")){c+="?noCache="+$time()}this.options.container=this.box=new Element("span",{"class":"swiff-uploader-box"}).inject($(this.options.container)||document.body);this.target=$(this.options.target);if(this.target){var a=window.getScroll();this.box.setStyles({position:"absolute",visibility:"visible",zIndex:this.options.zIndex,overflow:"hidden",height:1,width:1,top:a.y,left:a.x});this.parent(c,{params:{wMode:"transparent"},height:"100%",width:"100%"});this.target.addEvent("mouseenter",this.reposition.bind(this,[]));this.addEvents({buttonEnter:this.targetRelay.bind(this,["mouseenter"]),buttonLeave:this.targetRelay.bind(this,["mouseleave"]),buttonDown:this.targetRelay.bind(this,["mousedown"]),buttonDisable:this.targetRelay.bind(this,["disable"])});this.reposition();window.addEvent("resize",this.reposition.bind(this,[]))}else{this.parent(c)}this.inject(this.box);this.fileList=[];this.size=this.uploading=this.bytesLoaded=this.percentLoaded=0;if(Browser.Plugins.Flash.version<9){this.fireEvent("fail",["flash"])}else{this.verifyLoad.delay(1000,this)}},verifyLoad:function(){if(this.loaded){return}if(!this.object.parentNode){this.fireEvent("fail",["disabled"])}else{if(this.object.style.display=="none"){this.fireEvent("fail",["hidden"])}else{if(!this.object.offsetWidth){this.fireEvent("fail",["empty"])}}}},fireCallback:function(b,a){if(b.substr(0,4)=="file"){if(a.length>1){this.update(a[1])}var e=a[0];var c=this.findFile(e.id);this.fireEvent(b,c||e,5);if(c){var d=b.replace(/^file([A-Z])/,function(g,f){return f.toLowerCase()});c.update(e).fireEvent(d,[e],10)}}else{this.fireEvent(b,a,5)}},update:function(a){$extend(this,a);this.fireEvent("queue",[this],10);return this},findFile:function(b){for(var a=0;a<this.fileList.length;a++){if(this.fileList[a].id==b){return this.fileList[a]}}return null},initializeSwiff:function(){this.remote("initialize",{width:this.options.width,height:this.options.height,typeFilter:this.options.typeFilter,multiple:this.options.multiple,queued:this.options.queued,url:this.options.url,method:this.options.method,data:this.options.data,mergeData:this.options.mergeData,fieldName:this.options.fieldName,verbose:this.options.verbose,fileSizeMin:this.options.fileSizeMin,fileSizeMax:this.options.fileSizeMax,allowDuplicates:this.options.allowDuplicates,timeLimit:this.options.timeLimit,buttonImage:this.options.buttonImage,policyFile:this.options.policyFile});this.loaded=true;this.appendCookieData()},targetRelay:function(a){if(this.target){this.target.fireEvent(a)}},reposition:function(a){a=a||(this.target&&this.target.offsetHeight)?this.target.getCoordinates(this.box.getOffsetParent()):{top:window.getScrollTop(),left:0,width:40,height:40};this.box.setStyles(a);this.fireEvent("reposition",[a,this.box,this.target])},setOptions:function(a){if(a){if(a.url){a.url=Swiff.Uploader.qualifyPath(a.url)}if(a.buttonImage){a.buttonImage=Swiff.Uploader.qualifyPath(a.buttonImage)}this.parent(a);if(this.loaded){this.remote("setOptions",a)}}return this},setEnabled:function(a){this.remote("setEnabled",a)},start:function(){this.fireEvent("beforeStart");this.remote("start")},stop:function(){this.fireEvent("beforeStop");this.remote("stop")},remove:function(){this.fireEvent("beforeRemove");this.remote("remove")},fileStart:function(a){this.remote("fileStart",a.id)},fileStop:function(a){this.remote("fileStop",a.id)},fileRemove:function(a){this.remote("fileRemove",a.id)},fileRequeue:function(a){this.remote("fileRequeue",a.id)},appendCookieData:function(){var a=this.options.appendCookieData;if(!a){return}var c={};document.cookie.split(/;\s*/).each(function(d){d=d.split("=");if(d.length==2){c[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}});var b=this.options.data||{};if($type(a)=="string"){b[a]=c}else{$extend(b,c)}this.setOptions({data:b})},processFiles:function(f,d,a){var c=this.options.fileClass||Swiff.Uploader.File;var b=[],e=[];if(f){f.each(function(h){var g=new c(this,h);if(!g.validate()){g.remove.delay(10,g);b.push(g)}else{this.size+=h.size;this.fileList.push(g);e.push(g);g.render()}},this);this.fireEvent("selectSuccess",[e],10)}if(d||b.length){b.extend((d)?d.map(function(g){return new c(this,g)},this):[]).each(function(g){g.invalidate().render()});this.fireEvent("selectFail",[b],10)}this.update(a);if(this.options.instantStart&&e.length){this.start()}}});$extend(Swiff.Uploader,{STATUS_QUEUED:0,STATUS_RUNNING:1,STATUS_ERROR:2,STATUS_COMPLETE:3,STATUS_STOPPED:4,log:function(){},unitLabels:{b:[{min:1,unit:"B"},{min:1024,unit:"kB"},{min:1048576,unit:"MB"},{min:1073741824,unit:"GB"}],s:[{min:1,unit:"s"},{min:60,unit:"m"},{min:3600,unit:"h"},{min:86400,unit:"d"}]},formatUnit:function(a,h,b){var f=Swiff.Uploader.unitLabels[(h=="bps")?"b":h];var c=(h=="bps")?"/s":"";var e,d=f.length,j;if(a<1){return"0 "+f[0].unit+c}if(h=="s"){var g=[];for(e=d-1;e>=0;e--){j=Math.floor(a/f[e].min);if(j){g.push(j+" "+f[e].unit);a-=j*f[e].min;if(!a){break}}}return(b===false)?g:g.join(b||", ")}for(e=d-1;e>=0;e--){j=f[e].min;if(a>=j){break}}return(a/j).toFixed(1)+" "+f[e].unit+c}});Swiff.Uploader.qualifyPath=(function(){var a;return function(b){(a||(a=new Element("a"))).href=b;return a.href}})();Swiff.Uploader.File=new Class({Implements:Events,initialize:function(b,a){this.base=b;this.update(a)},update:function(a){return $extend(this,a)},validate:function(){var a=this.base.options;if(a.fileListMax&&this.base.fileList.length>=a.fileListMax){this.validationError="fileListMax";return false}if(a.fileListSizeMax&&(this.base.size+this.size)>a.fileListSizeMax){this.validationError="fileListSizeMax";return false}return true},invalidate:function(){this.invalid=true;this.base.fireEvent("fileInvalid",this,10);return this.fireEvent("invalid",this,10)},render:function(){return this},setOptions:function(a){if(a){if(a.url){a.url=Swiff.Uploader.qualifyPath(a.url)}this.base.remote("fileSetOptions",this.id,a);this.options=$merge(this.options,a)}return this},start:function(){this.base.fileStart(this);return this},stop:function(){this.base.fileStop(this);return this},remove:function(){this.base.fileRemove(this);return this},requeue:function(){this.base.fileRequeue(this)}});
